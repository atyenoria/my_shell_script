#!/bin/bash
#for sublime debug tool

#ruby
BUILD_RUBY="/Users/jima/.rbenv/shims/ruby"

#sh
BUILD_SH="/bin/sh"

#php
BUILD_PHP="/usr/local/bin/php"



TMP=`pbpaste`
BUILD_LOG="/Users/jima/log_build/log_sublime"

#成功、失敗画像
IMG_SUCCEED=/Users/jima/log_build/build_succeed.jpg
IMG_FAILED=/Users/jima/log_build/build_faild.jpeg


function build_status(){
if [ $? == 0 ]; 
then
#成功
terminal-notifier -message "$FORMAT build" -title Succeed -sound default -contentImage $IMG_SUCCEED
else
#失敗
terminal-notifier -message "$FORMAT build" -title Faild -sound default -contentImage $IMG_FAILED
fi
}

function build_sh(){
terminal-notifier -message Build -title "Shell Script" -sound default 
}

function build_after(){

build_status

tail -f $BUILD_LOG	
}

clear
#パスの拡張子を取り出す
TYPE=${TMP##*.}
case $TYPE in
	sh)
		echo "これはsh" > $BUILD_LOG
		#対話式TMP
		osascript -e 'tell application "Keyboard Maestro Engine" to do script "7FF4D9E6-B13D-433B-A5B9-4A7B88E6EA37"'
		#実行出力
		#$BUILD_SH $TMP > $BUILD_LOG 2>&1
		build_sh
		;;
	rb)
		FORMAT="Ruby"
		$BUILD_RUBY $TMP > $BUILD_LOG 2>&1
		build_after
		;;
	php)
		FORMAT="PHP"
		$BUILD_PHP $TMP > $BUILD_LOG 2>&1	 
		build_after
		;;
	*)
		echo "実行ファイル" > $BUILD_LOG 2>&1
		terminal-notifier -message Build -title "Exec File" -sound default 
		osascript -e 'tell application "Keyboard Maestro Engine" to do script "BAFBF368-2E1A-41C4-9F8A-62870A86BEB5"'
		;;
esac

